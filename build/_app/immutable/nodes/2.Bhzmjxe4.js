import{s as Y,o as J,f as tt,e as et,h as K,n as st}from"../chunks/scheduler.DmixjgyW.js";import{S as Q,i as Z,e as S,s as k,c as v,a as L,k as N,f as T,d as M,l,g as I,h as d,z as it,m as E,r as nt,n as R,p as ot,t as O,b as A,j as rt,A as B,v as at,w as lt,x as ct,y as ht}from"../chunks/index.BanJ8KNA.js";import{L as F,V as y,B as P,a as x,C as ut,S as _t,W as mt,P as dt,b as pt,M as ft,l as gt,R as wt,c as St,T as vt,d as Mt,e as G,N as $,f as Ct,g as j,h as q,A as bt,i as U,D as yt,j as Lt,k as Pt,m as xt,n as kt}from"../chunks/modelLoader.BuleLtHr.js";class H{constructor(t){this._isAllowed=!0,this._points=new Array,this._isConstructingLine=!0,this._isFirstLine=!0,this._scene=t;const e=new F({color:16711680}),s=[new y,new y],i=new P().setFromPoints(s);this._tempLine=new x(i,e),this._finalLine=new x(i,e),this._scene.add(this._tempLine),this._scene.add(this._finalLine)}processClickEvent(t){this._isAllowed&&(this._isConstructingLine?(console.log("line startd"),this._isFirstLine&&(this._lineStart=t,this._isFirstLine=!1,this._isConstructingLine=!0),this._isConstructingLine=!1,this._points.push(t)):(this._isConstructingLine=!0,this._lineStart=t,this._points.push(t),this._finalLine.geometry=new P().setFromPoints(this._points)))}processMouseMove(t){t!=null&&this._isConstructingLine&&(this._tempLine.geometry=new P().setFromPoints([this._lineStart,t]))}getCurveToSimulate(){return this._pathOfSimulation}constructCurve(){this._pathOfSimulation=new ut(this._points);const t=new P().setFromPoints(this._pathOfSimulation.getPoints(100)),e=new F({color:16777215});this._pathObject=new x(t,e),this._pathObject.position.copy(new y(.4,0,0)),this._isAllowed=!1,this._scene.remove(this._finalLine),this._scene.remove(this._tempLine),this._scene.add(this._pathObject)}getNumberOfPoints(){return this._points.length}reset(){this._isAllowed=!0,this._isConstructingLine=!1,this._isFirstLine=!0,this._points=[],this._scene.remove(this._pathObject);const t=new F({color:65280}),e=[new y,new y],s=new P().setFromPoints(e);this._tempLine=new x(s,t),this._finalLine=new x(s,t),this._scene.add(this._tempLine),this._scene.add(this._finalLine)}}class Tt{constructor(t,e,s,i){this._isInProgress=!1,this._numberOfPoints=0,this._simSpeed=230,this._numberOfPoints=e,this._meshToSimulate=s,this._path=i,this._scene=t,this._meshToSimulate.castShadow=!0,t.add(this._meshToSimulate)}simulate(t,e){var u;(u=document.getElementById("simulationSpeed"))==null||u.addEventListener("change",a=>{this._simSpeed=a.target.value*16}),console.log(this._simSpeed);const s=(t/this._simSpeed%this._numberOfPoints+1)/(this._numberOfPoints+1),i=this._path.getPointAt(s),r=this._path.getTangentAt(s).normalize();this._meshToSimulate.position.copy(i),this._meshToSimulate.lookAt(i.clone().add(r))}reset(){this._scene.remove(this._meshToSimulate)}}class It{constructor(t){var e;this._isSimulationRunning=!1,this._mousePosX=0,this._mousePosY=0,this._mousePointInWorld=new y,this._isValidIntersection=!1,this._simulationSpeed=2e3,this._animate=s=>{requestAnimationFrame(this._animate),this.update(s),this.render()},this._scene=new _t,this._renderer=new mt({canvas:t,antialias:!0,alpha:!0}),this._renderer.setSize(t.clientWidth,t.clientHeight),this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=dt,this._camera=new pt(65,t.clientWidth/t.clientHeight,.1,1e3),this._controls=new ft(this._camera,t),this._processMouseMove=this._processMouseMove.bind(this),this._processMouseClick=this._processMouseClick.bind(this),this._start=this._start.bind(this),this._pathConstructor=new H(this._scene),this._stratButton=(e=document.getElementById("start"))==null?void 0:e.addEventListener("click",this._start),this._renderer.domElement.addEventListener("mousemove",this._processMouseMove),this._renderer.domElement.addEventListener("click",this._processMouseClick),this._pathConstructor=new H(this._scene),gt("/models/red_lego_car.glb").then(s=>{this._meshToSimulate=s.scene.children[0].clone(),this._meshToSimulate.castShadow=!0,this._meshToSimulate.receiveShadow=!0,this._meshToSimulate.scale.set(.5,.5,.5)})}init(){this._setUpFloor(),this._setUpLight(),this._camera.position.set(0,5,5),this._camera.lookAt(0,0,0),this._controls.target.set(0,2,3),this._animate()}render(){this._renderer.render(this._scene,this._camera)}update(t){this._isSimulationRunning&&this._simulation.simulate(t,this._simulationSpeed)}getMousePosInWorldSpace(){const t=new wt;t.setFromCamera(new St(this._mousePosX,this._mousePosY),this._camera);const e=t.intersectObject(this._planeOfIntersection,!0);return e.length>0?(this._mousePointInWorld=e[0].point,this._isValidIntersection=!0,new y(e[0].point.x,1,e[0].point.z)):(this._isValidIntersection=!1,console.warn("No intersection found with the plane."),new y)}_setUpFloor(){const t=new kt,e=new vt(t),s=e.load("/textures/gravel_stones_diff_2k.jpg"),i=e.load("/textures/gravel_stones_ao_2k.jpg"),r=e.load("/textures/gravel_stones_nor_gl_2k.jpg"),u=e.load("/textures/gravel_stones_rough_2k.jpg");s.colorSpace=Mt,s.wrapS=G,s.wrapT=G,s.generateMipmaps=!1,s.minFilter=$,s.magFilter=$;const a=new Ct(10,10),_=new j({map:s,roughnessMap:u,normalMap:r,aoMap:i}),c=new q(a,_);c.rotation.x=-Math.PI/2,c.receiveShadow=!0,c.castShadow=!0,this._planeOfIntersection=c,this._scene.add(c)}_setUpLight(){const t=new bt(U.NAMES.white,.2),e=new yt(U.NAMES.white,4);e.position.set(12,10,0),e.castShadow=!0,e.shadow.camera.near=2,e.shadow.camera.far=50,e.shadow.camera.left=-10,e.shadow.camera.right=10,e.shadow.camera.top=10,e.shadow.camera.bottom=-10,e.shadow.camera.scale.set(2,2,2),new Lt(e.shadow.camera),this._scene.add(t),this._scene.add(e)}_processMouseMove(t){this._mousePosX=(t.clientX-this._renderer.domElement.offsetLeft)/this._renderer.domElement.clientWidth*2-1,this._mousePosY=(t.clientY-this._renderer.domElement.offsetTop)/this._renderer.domElement.clientHeight*-2+1,this.getMousePosInWorldSpace(),this._isValidIntersection&&this._pathConstructor.processMouseMove(this._mousePointInWorld)}_processMouseClick(t){console.log("click"),this._isValidIntersection&&this._pathConstructor.processClickEvent(this._mousePointInWorld)}_start(){const t=this._pathConstructor.getNumberOfPoints();if(t>0&&!this._isSimulationRunning){new Pt(.2),new j,this._pathConstructor.constructCurve();const e=this._pathConstructor.getCurveToSimulate();this._simulation=new Tt(this._scene,t,this._meshToSimulate,e),this._isSimulationRunning=!0}else console.log("reset"),this._isSimulationRunning=!1,this._pathConstructor.reset(),this._simulation.reset()}_setUpBox(){const t=new xt(1,1,1),e=new j;this._testObject=new q(t,e),this._scene.add(this._testObject)}}function Et(o){const t=o-1;return t*t*t+1}function z(o){return--o*o*o*o*o+1}function D(o,{delay:t=0,duration:e=400,easing:s=Et,start:i=0,opacity:r=0}={}){const u=getComputedStyle(o),a=+u.opacity,_=u.transform==="none"?"":u.transform,c=1-i,h=a*(1-r);return{delay:t,duration:e,easing:s,css:(f,w)=>`
			transform: ${_} scale(${1-c*w});
			opacity: ${a-h*w}
		`}}function X(o){let t,e,s,i,r,u,a,_="Simulation speed",c,h,f,w;return{c(){t=S("dvi"),e=S("p"),s=O("Simulation is runnwing for: "),i=O(o[2]),r=O(" s"),u=k(),a=S("p"),a.textContent=_,c=k(),h=S("input"),this.h()},l(n){t=v(n,"DVI",{class:!0});var g=L(t);e=v(g,"P",{class:!0});var C=L(e);s=A(C,"Simulation is runnwing for: "),i=A(C,o[2]),r=A(C," s"),C.forEach(M),u=T(g),a=v(g,"P",{class:!0,"data-svelte-h":!0}),N(a)!=="svelte-jhcq6t"&&(a.textContent=_),c=T(g),h=v(g,"INPUT",{id:!0,name:!0,type:!0}),g.forEach(M),this.h()},h(){l(e,"class","text-white w-full text-center"),l(a,"class","text-white mt-1 text-sm"),l(h,"id","simulationSpeed"),l(h,"name","sim_speed"),l(h,"type","range"),l(t,"class","mt-2")},m(n,g){I(n,t,g),d(t,e),d(e,s),d(e,i),d(e,r),d(t,u),d(t,a),d(t,c),d(t,h),w=!0},p(n,g){(!w||g&4)&&rt(i,n[2])},i(n){w||(n&&tt(()=>{w&&(f||(f=B(t,D,{duration:400,delay:0,opacity:0,start:.5,easing:z},!0)),f.run(1))}),w=!0)},o(n){n&&(f||(f=B(t,D,{duration:400,delay:0,opacity:0,start:.5,easing:z},!1)),f.run(0)),w=!1},d(n){n&&M(t),n&&f&&f.end()}}}function Ot(o){let t,e;return{c(){t=S("img"),this.h()},l(s){t=v(s,"IMG",{src:!0,alt:!0}),this.h()},h(){K(t.src,e="/icons/stop-button.png")||l(t,"src",e),l(t,"alt","play")},m(s,i){I(s,t,i)},d(s){s&&M(t)}}}function At(o){let t,e;return{c(){t=S("img"),this.h()},l(s){t=v(s,"IMG",{src:!0,alt:!0}),this.h()},h(){K(t.src,e="/icons/play.png")||l(t,"src",e),l(t,"alt","play")},m(s,i){I(s,t,i)},d(s){s&&M(t)}}}function Ft(o){let t,e,s="Speak",i,r,u="",a,_,c,h,f,w,n=!o[1]&&X(o);function g(m,p){return m[1]?At:Ot}let C=g(o),b=C(o);return{c(){t=S("section"),e=S("a"),e.textContent=s,i=k(),r=S("canvas"),r.innerHTML=u,a=k(),n&&n.c(),_=k(),c=S("div"),h=S("button"),b.c(),this.h()},l(m){t=v(m,"SECTION",{class:!0});var p=L(t);e=v(p,"A",{class:!0,href:!0,"data-svelte-h":!0}),N(e)!=="svelte-chdaqv"&&(e.textContent=s),i=T(p),r=v(p,"CANVAS",{id:!0,class:!0,"data-svelte-h":!0}),N(r)!=="svelte-11v1yan"&&(r.innerHTML=u),a=T(p),n&&n.l(p),_=T(p),c=v(p,"DIV",{class:!0});var V=L(c);h=v(V,"BUTTON",{id:!0,class:!0});var W=L(h);b.l(W),W.forEach(M),V.forEach(M),p.forEach(M),this.h()},h(){l(e,"class","speak-btn p-2 w-20 text-zinc-900 shadow-2xl duration-300 rounded-lg text-center  svelte-oqf1ki"),l(e,"href","/speech"),l(r,"id","maincanvas"),l(r,"class","h-full w-full"),l(h,"id","start"),l(h,"class","w-20 h-20 rounded-2xl shadow-2xl hover:w-24 hover:h-24 duration-100 mt-10"),l(c,"class","flex flex-row itmes-center"),l(t,"class","flex w-[80%] h-[80%] flex-col items-center rounded-2xl ")},m(m,p){I(m,t,p),d(t,e),d(t,i),d(t,r),o[4](r),d(t,a),n&&n.m(t,null),d(t,_),d(t,c),d(c,h),b.m(h,null),f||(w=it(h,"click",o[3]),f=!0)},p(m,[p]){m[1]?n&&(nt(),R(n,1,1,()=>{n=null}),ot()):n?(n.p(m,p),p&2&&E(n,1)):(n=X(m),n.c(),E(n,1),n.m(t,_)),C!==(C=g(m))&&(b.d(1),b=C(m),b&&(b.c(),b.m(h,null)))},i(m){E(n)},o(m){R(n)},d(m){m&&M(t),o[4](null),n&&n.d(),b.d(),f=!1,w()}}}function jt(o,t,e){let s,i=!0,r=0;function u(){i?(e(1,i=!1),e(2,r=0)):e(1,i=!0),setInterval(()=>{e(2,r+=1)},1e3)}J(()=>{new It(s).init()});function a(_){et[_?"unshift":"push"](()=>{s=_,e(0,s)})}return[s,i,r,u,a]}class Nt extends Q{constructor(t){super(),Z(this,t,jt,Ft,Y,{})}}function Rt(o){let t,e,s;return e=new Nt({}),{c(){t=S("div"),at(e.$$.fragment),this.h()},l(i){t=v(i,"DIV",{class:!0});var r=L(t);lt(e.$$.fragment,r),r.forEach(M),this.h()},h(){l(t,"class","w-full h-full flex flex-col items-center justify-center")},m(i,r){I(i,t,r),ct(e,t,null),s=!0},p:st,i(i){s||(E(e.$$.fragment,i),s=!0)},o(i){R(e.$$.fragment,i),s=!1},d(i){i&&M(t),ht(e)}}}function Vt(o){let t="";async function e(){try{const s=await fetch("http://localhost:5000/get-file");if(!s.ok)throw new Error("Network response was not ok");t=(await s.json()).content}catch(s){console.error("Error fetching transcription:",s)}}return J(()=>{e()}),[]}class $t extends Q{constructor(t){super(),Z(this,t,Vt,Rt,Y,{})}}export{$t as component};
